# 日志清理脚本使用指南

这个脚本用于清理日志文件中的tqdm进度条和重复的评估信息，使日志文件更加简洁易读。

## 功能特性

- 🧹 **自动识别和删除**：删除tqdm进度条（如 `50%|██████░░░| 100/200 [00:30<00:20, 5.21it/s]`）
- 🔍 **智能模式匹配**：删除包含重复评估信息的行（如 `[EVAL] Top-1:62.500| Top-5:82.812`）
- 💾 **安全备份**：自动备份原文件（可选）
- 👀 **预览模式**：支持预览清理效果而不实际修改文件
- 📁 **批量处理**：支持递归处理整个目录树
- 🎯 **灵活过滤**：支持文件名模式匹配

## 使用方法

### 基本用法

```bash
# 在当前目录下清理所有日志文件
python clean_logs.py

# 清理指定目录的所有日志文件
python clean_logs.py --logs-dir /path/to/logs

# 清理指定文件
python clean_logs.py --file /path/to/logfile.log
```

### 高级用法

```bash
# 预览模式 - 查看清理效果但不实际修改文件
python clean_logs.py --dry-run

# 不创建备份文件
python clean_logs.py --no-backup

# 只处理特定模式的文件
python clean_logs.py --pattern "*.log"

# 组合使用
python clean_logs.py --logs-dir ./logs --pattern "test*.log" --dry-run
```

## 命令行参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `--logs-dir` | 日志文件目录 | 当前目录 |
| `--file` | 处理指定的单个文件 | - |
| `--pattern` | 文件名模式，如 "*.log" | - |
| `--dry-run` | 预览模式，不实际修改文件 | False |
| `--no-backup` | 不备份原文件 | False |

## 清理规则

脚本会删除以下类型的内容：

1. **tqdm进度条**：
   ```
   50%|██████░░░| 100/200 [00:30<00:20, 5.21it/s]
   ```

2. **包含进度条的评估信息**：
   ```
   [31m[EVAL] Top-1:62.500| Top-5:82.812[0m: 50%|██████░░░| 100/200 [00:30<?, ?it/s]
   ```

3. **重复的评估信息行**：
   ```
   [31m[EVAL] Top-1:55.469| Top-5:84.375[0m: 1%| | 1/157 [00:00<00:20, 7.53it/s]
   [31m[EVAL] Top-1:59.375| Top-5:82.292[0m: 1%|▏ | 2/157 [00:00<00:20, 7.53it/s]
   ```

4. **空的进度条起始行**：
   ```
   0%| | 0/157 [00:00<?, ?it/s]
   ```

## 清理效果示例

### 清理前（976行）：
```log
[31m[EVAL] Top-1:62.500| Top-5:82.812[0m: 0%| | 0/157 [00:00<?, ?it/s]
[31m[EVAL] Top-1:62.500| Top-5:82.812[0m: 1%| | 1/157 [00:00<00:20, 7.53it/s]
[31m[EVAL] Top-1:55.469| Top-5:84.375[0m: 1%| | 1/157 [00:00<00:20, 7.53it/s]
[31m[EVAL] Top-1:59.375| Top-5:82.292[0m: 1%|▏ | 2/157 [00:00<00:20, 7.53it/s]
[31m[EVAL] Top-1:60.938| Top-5:83.594[0m: 2%|▏ | 3/157 [00:00<00:20, 7.53it/s]
```

### 清理后（113行）：
```log
Epoch 1: Training...
  Batch 100/782 - Loss CE: 4.3693, Loss KD: 0.0018
  Batch 200/782 - Loss CE: 4.2130, Loss KD: 0.0017
Epoch 1 Training Complete - Avg Loss CE: 3.8203, Avg Loss KD: 0.0015
Epoch 1 Results - Train Acc: 11.28% | Test Acc: 16.90% | Best: 16.90%
```

## 安全性

- ✅ **自动备份**：原文件会自动备份为 `.backup` 扩展名
- ✅ **预览模式**：可以先预览清理效果
- ✅ **错误处理**：处理文件时的错误不会影响其他文件的处理
- ✅ **编码兼容**：支持UTF-8编码，对于其他编码会忽略错误

## 使用场景

这个脚本特别适用于：

- 🔬 **机器学习实验日志**：清理训练和验证过程中的进度条
- 📊 **深度学习模型训练**：删除epoch进度和评估重复信息
- 🧪 **科研项目日志**：保持日志文件的简洁性
- 💾 **存储空间优化**：显著减少日志文件大小

## 技术特性

- 使用正则表达式精确匹配需要删除的模式
- 支持递归目录搜索
- 内存友好的逐行处理方式
- 跨平台兼容（Linux/Windows/macOS）

## 示例输出

运行脚本后会显示详细的处理报告：

```
找到 26 个日志文件
--------------------------------------------------
处理: ./quick_validation/test1_global_lskd.log
原文件已备份到: ./quick_validation/test1_global_lskd.log.backup
  原始行数: 976, 清理后: 113, 删除: 863 行

--------------------------------------------------
清理完成!
处理文件数: 26
有变化的文件数: 11
总原始行数: 37494
总清理后行数: 19228
总删除行数: 18266
```

## 注意事项

1. 首次使用建议加上 `--dry-run` 参数预览效果
2. 备份文件会占用额外的磁盘空间
3. 脚本会保留所有有意义的信息，只删除冗余的进度条内容
4. 对于已经清理过的文件，脚本会智能识别并跳过处理

---

**享受更清洁的日志文件！** 🎉
